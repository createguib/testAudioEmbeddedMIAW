<!DOCTYPE html>
<html>
<head>
    <title>Página de Prueba de Salesforce Chat</title>
</head>
<body>
    <audio id="AudioId">
	    <source src="notification_client.mp3" type="audio/mpeg">
    </audio>
        
        // **TU CÓDIGO DE SNIPPET DE CHAT DE SALESFORCE VA AQUÍ**
            function initEmbeddedMessaging() {
                try {
                    embeddedservice_bootstrap.settings.language = 'es'; // Idioma padrão do chat
					
                    // Espera o carregamento completo do componente para aplicar o CSS
                    window.addEventListener("onEmbeddedMessagingReady", () => {            
                        console.log("Inside Prechat API!!");

                        embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({           
		                    "Language": "Espanol",
		                    "Code_Language": "es",
		                    "POS": "CL",
		                    "IATA": "0"
		                });                 
                    });

                    // Inicializa la Conversation Sent Listener 
                    window.addEventListener( "onEmbeddedMessageSent", ( event ) => {
                    console.log( "START:: Conversation Sent" );
                    console.log( "Page location is " + window.location.href );
                    console.log( "Event detail: ", JSON.stringify( event.detail ) );

                    // Obtenemos el detalle del evento para facilitar el acceso 
                    const messageDetail = event.detail;
                    // Accedemos al rol del remitente a través de la ruta: conversationEntry.sender.role 
                    const senderRole = messageDetail.conversationEntry.sender.role;
    
                    if (senderRole === "Agent") {
                        if (document.hidden) {
                                let objSound = document.getElementById( "AudioId" );
                                objSound.play();
                        }
                    }
                    console.log( "END:: Conversation Sent" );
                    } );
                    // Finalización de Conversation Sent Listener 
        
                    // Inicializa o Embedded Messaging
                    embeddedservice_bootstrap.init(
                        '00DVG0000066nAf',
                        'Chat_Latam_Airlines_EC',
                        'https://latamneworg--latamdev.sandbox.my.site.com/ESWChatLatamAirlinesEC1713540918754',
                        {
                            scrt2URL: 'https://latamneworg--latamdev.sandbox.my.salesforce-scrt.com'
                        }
                    );
        
                } catch (err) {
                    console.error('Error loading Embedded Messaging: ', err);
                }
            };
        </script>

        <script type='text/javascript' 
                src='https://latamneworg--latamdev.sandbox.my.site.com/ESWChatLatamAirlinesEC1713540918754/assets/js/bootstrap.min.js' 
                onload='initEmbeddedMessaging()'>        
        </script>
	
    </body>
</html>
