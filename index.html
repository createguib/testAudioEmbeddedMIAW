<!DOCTYPE html>
<html>
<head>
    <title>PÃ¡gina de Prueba de Salesforce Chat</title>
</head>
<body>
    <h1>Â¡Bienvenido a la pÃ¡gina de prueba!</h1>
    <p>El widget y variables de chat de Salesforce deberÃ­a aparecer en esta pÃ¡gina.</p>

    <h2>Datos del Cliente Precargados:</h2>
    <p>âœ… Name: <strong id="mostrar_nombre">Cargando...</strong></p>
    <p>âœ… Lastname: <strong id="mostrar_apellido">Cargando...</strong></p>
    <p>ğŸ“§ Email: <strong id="mostrar_correo">Cargando...</strong></p>
    <p>ğŸ”‘ IATA: <strong id="mostrar_iata">Cargando...</strong></p>
    <p>ğŸŒ POS: <strong id="mostrar_pos">Cargando...</strong></p>
    <p>ğŸ—£ï¸ Idioma: <strong id="mostrar_idioma">Cargando...</strong></p>
    <p>ğŸ—£ï¸ Language: <strong id="mostrar_language">Cargando...</strong></p>
    
    <script type='text/javascript'>
        var datosCliente = {
            nombre: "git",
            apellido: "hub",
            correo: "createguib@gmail.com",
            iata: "12345678",
            pos: "CL",
            idioma: "Espanol",
            language: "es"
        };

        // ===============================================
        // 2. MOSTRAR DATOS EN LA PÃGINA (ETIQUETAS)
        // ===============================================
        //Estos datos son solo para verlos en la pagina test, no son necesarios que vayan:
        document.getElementById('mostrar_nombre').textContent = datosCliente.nombre;
        document.getElementById('mostrar_apellido').textContent = datosCliente.apellido;
        document.getElementById('mostrar_correo').textContent = datosCliente.correo;
        document.getElementById('mostrar_iata').textContent = datosCliente.iata;
        document.getElementById('mostrar_pos').textContent = datosCliente.pos;
        document.getElementById('mostrar_idioma').textContent = datosCliente.idioma;
        document.getElementById('mostrar_language').textContent = datosCliente.language;

        function launchChat() {
            console.log("launchChat() llamado");
            if (!window.embeddedservice_bootstrap || !embeddedservice_bootstrap.utilAPI) {
                console.error("utilAPI no estÃ¡ disponible todavÃ­a. Â¿Se cargÃ³ el widget?");
                return;
            }

            if (typeof embeddedservice_bootstrap.utilAPI.launchChat !== "function") {
                console.error("utilAPI.launchChat NO estÃ¡ disponible en esta versiÃ³n.");
                return;
            }

            embeddedservice_bootstrap.utilAPI.launchChat()
                .then(() => {
                    console.log("Chat lanzado correctamente via utilAPI.launchChat()");
                })
                .catch((err) => {
                    console.error("Error al lanzar el chat con utilAPI.launchChat():", err);
                })
                .finally(() => {
                    console.log("Intento de lanzar el chat finalizado (success o error).");
                });
        }
        
        // **TU CÃ“DIGO DE SNIPPET DE CHAT DE SALESFORCE VA AQUÃ**
            function initEmbeddedMessaging() {
                try {
                    embeddedservice_bootstrap.settings.language = 'es'; // Idioma padrÃ£o do chat
        
                    // Espera o carregamento completo do componente para aplicar o CSS
                    window.addEventListener("onEmbeddedMessagingReady", () => {            
                        console.log("Inside Prechat API!!");
                        const user = datosCliente || {};

                        // 1) Campos OCULTOS
                        embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({           
                            "Language"      : user.idioma,
                            "Code_Language" : user.language,
                            "POS"           : user.pos
                        });

                        // 2) Campos VISIBLES en el prechat
                        embeddedservice_bootstrap.prechatAPI.setVisiblePrechatFields({
                            "_firstName": {
                                    "value": user.nombre,
                                    "isEditableByEndUser":false
                            },
                            "_lastName": {
                                    "value": user.apellido,
                                    "isEditableByEndUser":false
                            },
                            "_email": {
                                    "value": user.correo,
                                    "isEditableByEndUser":false
                            },
                            "IATA": {
                                    "value": user.iata,
                                    "isEditableByEndUser":false
                            }
                        });

                        // Esto se ejecuta SOLO cuando el usuario ya abriÃ³ la burbuja
                        setTimeout(() => {
                            launchChat();
                        }, 2000); // prueba 800ms, si falla prueba 1200ms
                    });
        
                    // Inicializa o Embedded Messaging
                    embeddedservice_bootstrap.init(
                        '00DVG0000066nAf',
                        'Chat_Latam_Airlines_EC',
                        'https://latamneworg--latamdev.sandbox.my.site.com/ESWChatLatamAirlinesEC1713540918754',
                        {
                            scrt2URL: 'https://latamneworg--latamdev.sandbox.my.salesforce-scrt.com'
                        }
                    );
        
                } catch (err) {
                    console.error('Error loading Embedded Messaging: ', err);
                }
            };
        </script>

        <script type='text/javascript' 
                src='https://latamneworg--latamdev.sandbox.my.site.com/ESWChatLatamAirlinesEC1713540918754/assets/js/bootstrap.min.js' 
                onload='initEmbeddedMessaging()'>        
        </script>
    </body>
</html>
