<!DOCTYPE html>
<html>
<head>
    <title>P√°gina de Prueba de Salesforce Chat</title>
		<style>
            .send-button {
                background-color: #0078ff;
                border: none;
                color: white;
                border-radius: 50%;
                width: 36px;
                height: 36px;
                cursor: pointer;
                font-size: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background 0.2s;
            }
            .send-button:hover {
                background-color: #005fd1;
            }
            /* --- CSS for Styling the Button --- */
            .send-message-button {
                background-color: #00008b;
                color: white;
                padding: 15px 30px;
                font-size: 18px;
                font-weight: bold;
                cursor: pointer;
                border: none;
                display: inline-block;
                text-align: center;
                border-radius: 5px;
                box-shadow: 0 0 0 2px white;
                outline: 2px solid #00008b;
            }
            .send-message-button:hover {
                background-color: #0000a0;
            }
        </style>

	
</head>
<body>
    <audio id="AudioId">
	    <source src="notification_client.mp3" type="audio/mpeg">
    </audio>
    
    <h1>¬°Bienvenido a la p√°gina de prueba!</h1>
    <p>El widget y variables de chat de Salesforce deber√≠a aparecer en esta p√°gina.</p>

    <h2>Datos del Cliente Precargados:</h2>
    <p>‚úÖ Name: <strong id="mostrar_nombre">Cargando...</strong></p>
    <p>‚úÖ Lastname: <strong id="mostrar_apellido">Cargando...</strong></p>
    <p>üìß Email: <strong id="mostrar_correo">Cargando...</strong></p>
    <p>üîë IATA: <strong id="mostrar_iata">Cargando...</strong></p>
    <p>üåé POS: <strong id="mostrar_pos">Cargando...</strong></p>
    <p>üó£Ô∏è Idioma: <strong id="mostrar_idioma">Cargando...</strong></p>
    <p>üó£Ô∏è Language: <strong id="mostrar_language">Cargando...</strong></p>
    
    <script type='text/javascript'>
        var datosCliente = {
            nombre: "git",
            apellido: "hub",
            correo: "createguib@gmail.com",
            iata: "12345678",
            pos: "CL",
            idioma: "Espanol",
            language: "es"
        };

        // ===============================================
        // 2. MOSTRAR DATOS EN LA P√ÅGINA (ETIQUETAS)
        // ===============================================
        //Estos datos son solo para verlos en la pagina test, no son necesarios que vayan:
        document.getElementById('mostrar_nombre').textContent = datosCliente.nombre;
        document.getElementById('mostrar_apellido').textContent = datosCliente.apellido;
        document.getElementById('mostrar_correo').textContent = datosCliente.correo;
        document.getElementById('mostrar_iata').textContent = datosCliente.iata;
        document.getElementById('mostrar_pos').textContent = datosCliente.pos;
        document.getElementById('mostrar_idioma').textContent = datosCliente.idioma;
        document.getElementById('mostrar_language').textContent = datosCliente.language;
        
        // **TU C√ìDIGO DE SNIPPET DE CHAT DE SALESFORCE VA AQU√ç**
            function initEmbeddedMessaging() {
                try {
                    embeddedservice_bootstrap.settings.language = 'es'; // Idioma padr√£o do chat
					//***********************************************************************************************
					// Hiding Chat Button on page load
                    embeddedservice_bootstrap.settings.hideChatButtonOnLoad = true;                    
                    //* START:: Conversation Opened Listener */
                    window.addEventListener("onEmbeddedMessagingConversationOpened", (event) => {
                        hideChatContainer();
                    });
                    //* END:: Conversation Opened Listener */
					//* START:: Conversation Closed Listener */
                    window.addEventListener("onEmbeddedMessagingWindowClosed", (event) => {
                        showChatContainer();
                    });
                    //* END:: Conversation Closed Listener */
        
                    //* START:: Button Created Listener */
                    window.addEventListener("onEmbeddedMessagingButtonCreated", (event) => {
                        showChatContainer();
                    });
                    //* END:: Button Created Listener */
					//***********************************************************************************************

					
                    // Espera o carregamento completo do componente para aplicar o CSS
                    window.addEventListener("onEmbeddedMessagingReady", () => {            
                        console.log("Inside Prechat API!!");
                        const user = datosCliente || {};

                        // 1) Campos OCULTOS
                        embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({           
                            "Language"      : user.idioma,
                            "Code_Language" : user.language,
                            "POS"           : user.pos
                        });

                        // 2) Campos VISIBLES en el prechat
                        embeddedservice_bootstrap.prechatAPI.setVisiblePrechatFields({
                            "_firstName": {
                                    "value": user.nombre,
                                    "isEditableByEndUser":false
                            },
                            "_lastName": {
                                    "value": user.apellido,
                                    "isEditableByEndUser":false
                            },
                            "_email": {
                                    "value": user.correo,
                                    "isEditableByEndUser":false
                            },
                            "IATA": {
                                    "value": user.iata,
                                    "isEditableByEndUser":false
                            }
                        });                        
                    });

                    // Inicializa la Conversation Sent Listener 
                    window.addEventListener( "onEmbeddedMessageSent", ( event ) => {
                    console.log( "START:: Conversation Sent" );
                    console.log( "Page location is " + window.location.href );
                    console.log( "Event detail: ", JSON.stringify( event.detail ) );

                    // Obtenemos el detalle del evento para facilitar el acceso 
                    const messageDetail = event.detail;
                    // Accedemos al rol del remitente a trav√©s de la ruta: conversationEntry.sender.role 
                    const senderRole = messageDetail.conversationEntry.sender.role;
    
                    if (senderRole === "Agent") {
                        if (document.hidden) {
                                let objSound = document.getElementById( "AudioId" );
                                objSound.play();
                        }
                    }
                    console.log( "END:: Conversation Sent" );
                    } );
                    // Finalizaci√≥n de Conversation Sent Listener 
        
                    // Inicializa o Embedded Messaging
                    embeddedservice_bootstrap.init(
                        '00DVG0000066nAf',
                        'Chat_Latam_Airlines_EC',
                        'https://latamneworg--latamdev.sandbox.my.site.com/ESWChatLatamAirlinesEC1713540918754',
                        {
                            scrt2URL: 'https://latamneworg--latamdev.sandbox.my.salesforce-scrt.com'
                        }
                    );
        
                } catch (err) {
                    console.error('Error loading Embedded Messaging: ', err);
                }
            };
        </script>

        <script type='text/javascript' 
                src='https://latamneworg--latamdev.sandbox.my.site.com/ESWChatLatamAirlinesEC1713540918754/assets/js/bootstrap.min.js' 
                onload='initEmbeddedMessaging()'>        
        </script>

		//****************************************************************************************************************
		<div>
            Welcome to our Chat Service!
            <br/><br/>
        </div>
        <div class="chat-container">
            <div>
                Please select the menu or enter the message to get started.
                <br/>
            </div>
            <div>
                <br/><br/>
                <button class="send-message-button" id="orderButton">
                    Need help with my Order
                </button>
                <br/><br/>
                <button class="send-message-button" id="caseButton">
                    Need help with my Case
                </button>
                <br/><br/>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chatInput" class="chat-input" placeholder="Type a message..." />
                <button class="send-button" id="sendBtn">‚û§</button>
            </div>
        </div>

        <script>
            function showChatContainer() {
                const chatContainer = document.querySelector('.chat-container');
                chatContainer.style.display = 'block';
            }

            function hideChatContainer() {
                const chatContainer = document.querySelector('.chat-container');
                chatContainer.style.display = 'none';
            }
            
            function launchChat(message) {
                embeddedservice_bootstrap.utilAPI.launchChat()
                    .then(() => {
                        console.log('Successfully launched Messaging');
                        sendMessageToChat(message);
                    })
                    .catch(() => {
                        console.log('Some error occurred when launching Messaging');
                    })
                    .finally(() => {
                        console.log('Successfully launched Messaging - Finally');
                    });
            }
            
            function sendMessageToChat(message) {
                setTimeout(() => {
                    embeddedservice_bootstrap.utilAPI.sendTextMessage(message)
                        .then(() => {
                            console.log("Message sent");
                        })
                        .catch(() => {
                            console.log("Message not sent");
                        })
                        .finally(() => {
                            console.log("Message sent - finally");
                        });
                }, 8000);
            }
            
            const sendBtn = document.getElementById('sendBtn');
            const chatInput = document.getElementById('chatInput');
            sendBtn.addEventListener('click', () => {
                const message = chatInput.value.trim();
                if (message) {
                    console.log(message);
                    chatInput.value = '';
                    hideChatContainer();
                    launchChat(message);
                } else {
                    alert("Please enter a message first!");
                }
            });
            // Allow pressing Enter to send the message
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendBtn.click();
                }
            });
            
            // Get the button element using its ID
            const orderButton = document.getElementById('orderButton');
            // Add an event listener that runs a function when the button is clicked
            orderButton.addEventListener('click', function() {
                // Get the text content of the button
                const orderButtonText = orderButton.textContent.trim();
                // Display the text in the browser's console
                console.log(orderButtonText);
                launchChat(orderButtonText);
            });
            
            // Get the button element using its ID
            const caseButton = document.getElementById('caseButton');
            // Add an event listener that runs a function when the button is clicked
            caseButton.addEventListener('click', function() {
                // Get the text content of the button
                const caseButtonText = caseButton.textContent.trim();
                // Display the text in the browser's console
                console.log(caseButtonText);
                launchChat(caseButtonText);
            }); 
        </script>
		//****************************************************************************************************************
	
    </body>
</html>
